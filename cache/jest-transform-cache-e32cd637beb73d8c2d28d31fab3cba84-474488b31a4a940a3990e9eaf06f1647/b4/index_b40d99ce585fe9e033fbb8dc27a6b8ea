f3269445a94e435c6ac4ae1a82faca29
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.TestEnvironment = void 0;
function _jsdom() {
  const data = require('jsdom');
  _jsdom = function () {
    return data;
  };
  return data;
}
function _fakeTimers() {
  const data = require('@jest/fake-timers');
  _fakeTimers = function () {
    return data;
  };
  return data;
}
function _jestMock() {
  const data = require('jest-mock');
  _jestMock = function () {
    return data;
  };
  return data;
}
function _jestUtil() {
  const data = require('jest-util');
  _jestUtil = function () {
    return data;
  };
  return data;
}
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

function isString(value) {
  return typeof value === 'string';
}
class JSDOMEnvironment {
  dom;
  fakeTimers;
  fakeTimersModern;
  global;
  errorEventListener;
  moduleMocker;
  customExportConditions = ['browser'];
  constructor(config, context) {
    const {
      projectConfig
    } = config;
    const virtualConsole = new (_jsdom().VirtualConsole)();
    virtualConsole.sendTo(context.console, {
      omitJSDOMErrors: true
    });
    virtualConsole.on('jsdomError', error => {
      context.console.error(error);
    });
    this.dom = new (_jsdom().JSDOM)(typeof projectConfig.testEnvironmentOptions.html === 'string' ? projectConfig.testEnvironmentOptions.html : '<!DOCTYPE html>', {
      pretendToBeVisual: true,
      resources: typeof projectConfig.testEnvironmentOptions.userAgent === 'string' ? new (_jsdom().ResourceLoader)({
        userAgent: projectConfig.testEnvironmentOptions.userAgent
      }) : undefined,
      runScripts: 'dangerously',
      url: 'http://localhost/',
      virtualConsole,
      ...projectConfig.testEnvironmentOptions
    });
    const global = this.global = this.dom.window;
    if (global == null) {
      throw new Error('JSDOM did not return a Window object');
    }

    // @ts-expect-error - for "universal" code (code should use `globalThis`)
    global.global = global;

    // Node's error-message stack size is limited at 10, but it's pretty useful
    // to see more than that when a test fails.
    this.global.Error.stackTraceLimit = 100;
    (0, _jestUtil().installCommonGlobals)(global, projectConfig.globals);

    // TODO: remove this ASAP, but it currently causes tests to run really slow
    global.Buffer = Buffer;

    // Report uncaught errors.
    this.errorEventListener = event => {
      if (userErrorListenerCount === 0 && event.error != null) {
        process.emit('uncaughtException', event.error);
      }
    };
    global.addEventListener('error', this.errorEventListener);

    // However, don't report them as uncaught if the user listens to 'error' event.
    // In that case, we assume the might have custom error handling logic.
    const originalAddListener = global.addEventListener.bind(global);
    const originalRemoveListener = global.removeEventListener.bind(global);
    let userErrorListenerCount = 0;
    global.addEventListener = function (...args) {
      if (args[0] === 'error') {
        userErrorListenerCount++;
      }
      return originalAddListener.apply(this, args);
    };
    global.removeEventListener = function (...args) {
      if (args[0] === 'error') {
        userErrorListenerCount--;
      }
      return originalRemoveListener.apply(this, args);
    };
    if ('customExportConditions' in projectConfig.testEnvironmentOptions) {
      const {
        customExportConditions
      } = projectConfig.testEnvironmentOptions;
      if (Array.isArray(customExportConditions) && customExportConditions.every(isString)) {
        this.customExportConditions = customExportConditions;
      } else {
        throw new Error('Custom export conditions specified but they are not an array of strings');
      }
    }
    this.moduleMocker = new (_jestMock().ModuleMocker)(global);
    this.fakeTimers = new (_fakeTimers().LegacyFakeTimers)({
      config: projectConfig,
      global: global,
      moduleMocker: this.moduleMocker,
      timerConfig: {
        idToRef: id => id,
        refToId: ref => ref
      }
    });
    this.fakeTimersModern = new (_fakeTimers().ModernFakeTimers)({
      config: projectConfig,
      global: global
    });
  }

  // eslint-disable-next-line @typescript-eslint/no-empty-function
  async setup() {}
  async teardown() {
    if (this.fakeTimers) {
      this.fakeTimers.dispose();
    }
    if (this.fakeTimersModern) {
      this.fakeTimersModern.dispose();
    }
    if (this.global != null) {
      if (this.errorEventListener) {
        this.global.removeEventListener('error', this.errorEventListener);
      }
      this.global.close();
    }
    this.errorEventListener = null;
    // @ts-expect-error: this.global not allowed to be `null`
    this.global = null;
    this.dom = null;
    this.fakeTimers = null;
    this.fakeTimersModern = null;
  }
  exportConditions() {
    return this.customExportConditions;
  }
  getVmContext() {
    if (this.dom) {
      return this.dom.getInternalVMContext();
    }
    return null;
  }
}
exports.default = JSDOMEnvironment;
const TestEnvironment = JSDOMEnvironment;
exports.TestEnvironment = TestEnvironment;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJUZXN0RW52aXJvbm1lbnQiLCJfanNkb20iLCJkYXRhIiwicmVxdWlyZSIsIl9mYWtlVGltZXJzIiwiX2plc3RNb2NrIiwiX2plc3RVdGlsIiwiaXNTdHJpbmciLCJKU0RPTUVudmlyb25tZW50IiwiZG9tIiwiZmFrZVRpbWVycyIsImZha2VUaW1lcnNNb2Rlcm4iLCJnbG9iYWwiLCJlcnJvckV2ZW50TGlzdGVuZXIiLCJtb2R1bGVNb2NrZXIiLCJjdXN0b21FeHBvcnRDb25kaXRpb25zIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJjb250ZXh0IiwicHJvamVjdENvbmZpZyIsInZpcnR1YWxDb25zb2xlIiwiVmlydHVhbENvbnNvbGUiLCJzZW5kVG8iLCJjb25zb2xlIiwib21pdEpTRE9NRXJyb3JzIiwib24iLCJlcnJvciIsIkpTRE9NIiwidGVzdEVudmlyb25tZW50T3B0aW9ucyIsImh0bWwiLCJwcmV0ZW5kVG9CZVZpc3VhbCIsInJlc291cmNlcyIsInVzZXJBZ2VudCIsIlJlc291cmNlTG9hZGVyIiwidW5kZWZpbmVkIiwicnVuU2NyaXB0cyIsInVybCIsIndpbmRvdyIsIkVycm9yIiwic3RhY2tUcmFjZUxpbWl0IiwiaW5zdGFsbENvbW1vbkdsb2JhbHMiLCJnbG9iYWxzIiwiQnVmZmVyIiwiZXZlbnQiLCJ1c2VyRXJyb3JMaXN0ZW5lckNvdW50IiwicHJvY2VzcyIsImVtaXQiLCJhZGRFdmVudExpc3RlbmVyIiwib3JpZ2luYWxBZGRMaXN0ZW5lciIsImJpbmQiLCJvcmlnaW5hbFJlbW92ZUxpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFyZ3MiLCJhcHBseSIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiTW9kdWxlTW9ja2VyIiwiTGVnYWN5RmFrZVRpbWVycyIsInRpbWVyQ29uZmlnIiwiaWRUb1JlZiIsImlkIiwicmVmVG9JZCIsInJlZiIsIk1vZGVybkZha2VUaW1lcnMiLCJzZXR1cCIsInRlYXJkb3duIiwiZGlzcG9zZSIsImNsb3NlIiwiZXhwb3J0Q29uZGl0aW9ucyIsImdldFZtQ29udGV4dCIsImdldEludGVybmFsVk1Db250ZXh0Il0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGV4cG9ydHMuVGVzdEVudmlyb25tZW50ID0gdm9pZCAwO1xuZnVuY3Rpb24gX2pzZG9tKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnanNkb20nKTtcbiAgX2pzZG9tID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICByZXR1cm4gZGF0YTtcbn1cbmZ1bmN0aW9uIF9mYWtlVGltZXJzKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnQGplc3QvZmFrZS10aW1lcnMnKTtcbiAgX2Zha2VUaW1lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG4gIHJldHVybiBkYXRhO1xufVxuZnVuY3Rpb24gX2plc3RNb2NrKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnamVzdC1tb2NrJyk7XG4gIF9qZXN0TW9jayA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcbiAgcmV0dXJuIGRhdGE7XG59XG5mdW5jdGlvbiBfamVzdFV0aWwoKSB7XG4gIGNvbnN0IGRhdGEgPSByZXF1aXJlKCdqZXN0LXV0aWwnKTtcbiAgX2plc3RVdGlsID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICByZXR1cm4gZGF0YTtcbn1cbi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG5mdW5jdGlvbiBpc1N0cmluZyh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbn1cbmNsYXNzIEpTRE9NRW52aXJvbm1lbnQge1xuICBkb207XG4gIGZha2VUaW1lcnM7XG4gIGZha2VUaW1lcnNNb2Rlcm47XG4gIGdsb2JhbDtcbiAgZXJyb3JFdmVudExpc3RlbmVyO1xuICBtb2R1bGVNb2NrZXI7XG4gIGN1c3RvbUV4cG9ydENvbmRpdGlvbnMgPSBbJ2Jyb3dzZXInXTtcbiAgY29uc3RydWN0b3IoY29uZmlnLCBjb250ZXh0KSB7XG4gICAgY29uc3Qge3Byb2plY3RDb25maWd9ID0gY29uZmlnO1xuICAgIGNvbnN0IHZpcnR1YWxDb25zb2xlID0gbmV3IChfanNkb20oKS5WaXJ0dWFsQ29uc29sZSkoKTtcbiAgICB2aXJ0dWFsQ29uc29sZS5zZW5kVG8oY29udGV4dC5jb25zb2xlLCB7XG4gICAgICBvbWl0SlNET01FcnJvcnM6IHRydWVcbiAgICB9KTtcbiAgICB2aXJ0dWFsQ29uc29sZS5vbignanNkb21FcnJvcicsIGVycm9yID0+IHtcbiAgICAgIGNvbnRleHQuY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSk7XG4gICAgdGhpcy5kb20gPSBuZXcgKF9qc2RvbSgpLkpTRE9NKShcbiAgICAgIHR5cGVvZiBwcm9qZWN0Q29uZmlnLnRlc3RFbnZpcm9ubWVudE9wdGlvbnMuaHRtbCA9PT0gJ3N0cmluZydcbiAgICAgICAgPyBwcm9qZWN0Q29uZmlnLnRlc3RFbnZpcm9ubWVudE9wdGlvbnMuaHRtbFxuICAgICAgICA6ICc8IURPQ1RZUEUgaHRtbD4nLFxuICAgICAge1xuICAgICAgICBwcmV0ZW5kVG9CZVZpc3VhbDogdHJ1ZSxcbiAgICAgICAgcmVzb3VyY2VzOlxuICAgICAgICAgIHR5cGVvZiBwcm9qZWN0Q29uZmlnLnRlc3RFbnZpcm9ubWVudE9wdGlvbnMudXNlckFnZW50ID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgPyBuZXcgKF9qc2RvbSgpLlJlc291cmNlTG9hZGVyKSh7XG4gICAgICAgICAgICAgICAgdXNlckFnZW50OiBwcm9qZWN0Q29uZmlnLnRlc3RFbnZpcm9ubWVudE9wdGlvbnMudXNlckFnZW50XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgcnVuU2NyaXB0czogJ2Rhbmdlcm91c2x5JyxcbiAgICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdC8nLFxuICAgICAgICB2aXJ0dWFsQ29uc29sZSxcbiAgICAgICAgLi4ucHJvamVjdENvbmZpZy50ZXN0RW52aXJvbm1lbnRPcHRpb25zXG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCBnbG9iYWwgPSAodGhpcy5nbG9iYWwgPSB0aGlzLmRvbS53aW5kb3cpO1xuICAgIGlmIChnbG9iYWwgPT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdKU0RPTSBkaWQgbm90IHJldHVybiBhIFdpbmRvdyBvYmplY3QnKTtcbiAgICB9XG5cbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gZm9yIFwidW5pdmVyc2FsXCIgY29kZSAoY29kZSBzaG91bGQgdXNlIGBnbG9iYWxUaGlzYClcbiAgICBnbG9iYWwuZ2xvYmFsID0gZ2xvYmFsO1xuXG4gICAgLy8gTm9kZSdzIGVycm9yLW1lc3NhZ2Ugc3RhY2sgc2l6ZSBpcyBsaW1pdGVkIGF0IDEwLCBidXQgaXQncyBwcmV0dHkgdXNlZnVsXG4gICAgLy8gdG8gc2VlIG1vcmUgdGhhbiB0aGF0IHdoZW4gYSB0ZXN0IGZhaWxzLlxuICAgIHRoaXMuZ2xvYmFsLkVycm9yLnN0YWNrVHJhY2VMaW1pdCA9IDEwMDtcbiAgICAoMCwgX2plc3RVdGlsKCkuaW5zdGFsbENvbW1vbkdsb2JhbHMpKGdsb2JhbCwgcHJvamVjdENvbmZpZy5nbG9iYWxzKTtcblxuICAgIC8vIFRPRE86IHJlbW92ZSB0aGlzIEFTQVAsIGJ1dCBpdCBjdXJyZW50bHkgY2F1c2VzIHRlc3RzIHRvIHJ1biByZWFsbHkgc2xvd1xuICAgIGdsb2JhbC5CdWZmZXIgPSBCdWZmZXI7XG5cbiAgICAvLyBSZXBvcnQgdW5jYXVnaHQgZXJyb3JzLlxuICAgIHRoaXMuZXJyb3JFdmVudExpc3RlbmVyID0gZXZlbnQgPT4ge1xuICAgICAgaWYgKHVzZXJFcnJvckxpc3RlbmVyQ291bnQgPT09IDAgJiYgZXZlbnQuZXJyb3IgIT0gbnVsbCkge1xuICAgICAgICBwcm9jZXNzLmVtaXQoJ3VuY2F1Z2h0RXhjZXB0aW9uJywgZXZlbnQuZXJyb3IpO1xuICAgICAgfVxuICAgIH07XG4gICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgdGhpcy5lcnJvckV2ZW50TGlzdGVuZXIpO1xuXG4gICAgLy8gSG93ZXZlciwgZG9uJ3QgcmVwb3J0IHRoZW0gYXMgdW5jYXVnaHQgaWYgdGhlIHVzZXIgbGlzdGVucyB0byAnZXJyb3InIGV2ZW50LlxuICAgIC8vIEluIHRoYXQgY2FzZSwgd2UgYXNzdW1lIHRoZSBtaWdodCBoYXZlIGN1c3RvbSBlcnJvciBoYW5kbGluZyBsb2dpYy5cbiAgICBjb25zdCBvcmlnaW5hbEFkZExpc3RlbmVyID0gZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIuYmluZChnbG9iYWwpO1xuICAgIGNvbnN0IG9yaWdpbmFsUmVtb3ZlTGlzdGVuZXIgPSBnbG9iYWwucmVtb3ZlRXZlbnRMaXN0ZW5lci5iaW5kKGdsb2JhbCk7XG4gICAgbGV0IHVzZXJFcnJvckxpc3RlbmVyQ291bnQgPSAwO1xuICAgIGdsb2JhbC5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgIGlmIChhcmdzWzBdID09PSAnZXJyb3InKSB7XG4gICAgICAgIHVzZXJFcnJvckxpc3RlbmVyQ291bnQrKztcbiAgICAgIH1cbiAgICAgIHJldHVybiBvcmlnaW5hbEFkZExpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH07XG4gICAgZ2xvYmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgaWYgKGFyZ3NbMF0gPT09ICdlcnJvcicpIHtcbiAgICAgICAgdXNlckVycm9yTGlzdGVuZXJDb3VudC0tO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9yaWdpbmFsUmVtb3ZlTGlzdGVuZXIuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfTtcbiAgICBpZiAoJ2N1c3RvbUV4cG9ydENvbmRpdGlvbnMnIGluIHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucykge1xuICAgICAgY29uc3Qge2N1c3RvbUV4cG9ydENvbmRpdGlvbnN9ID0gcHJvamVjdENvbmZpZy50ZXN0RW52aXJvbm1lbnRPcHRpb25zO1xuICAgICAgaWYgKFxuICAgICAgICBBcnJheS5pc0FycmF5KGN1c3RvbUV4cG9ydENvbmRpdGlvbnMpICYmXG4gICAgICAgIGN1c3RvbUV4cG9ydENvbmRpdGlvbnMuZXZlcnkoaXNTdHJpbmcpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jdXN0b21FeHBvcnRDb25kaXRpb25zID0gY3VzdG9tRXhwb3J0Q29uZGl0aW9ucztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAnQ3VzdG9tIGV4cG9ydCBjb25kaXRpb25zIHNwZWNpZmllZCBidXQgdGhleSBhcmUgbm90IGFuIGFycmF5IG9mIHN0cmluZ3MnXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMubW9kdWxlTW9ja2VyID0gbmV3IChfamVzdE1vY2soKS5Nb2R1bGVNb2NrZXIpKGdsb2JhbCk7XG4gICAgdGhpcy5mYWtlVGltZXJzID0gbmV3IChfZmFrZVRpbWVycygpLkxlZ2FjeUZha2VUaW1lcnMpKHtcbiAgICAgIGNvbmZpZzogcHJvamVjdENvbmZpZyxcbiAgICAgIGdsb2JhbDogZ2xvYmFsLFxuICAgICAgbW9kdWxlTW9ja2VyOiB0aGlzLm1vZHVsZU1vY2tlcixcbiAgICAgIHRpbWVyQ29uZmlnOiB7XG4gICAgICAgIGlkVG9SZWY6IGlkID0+IGlkLFxuICAgICAgICByZWZUb0lkOiByZWYgPT4gcmVmXG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5mYWtlVGltZXJzTW9kZXJuID0gbmV3IChfZmFrZVRpbWVycygpLk1vZGVybkZha2VUaW1lcnMpKHtcbiAgICAgIGNvbmZpZzogcHJvamVjdENvbmZpZyxcbiAgICAgIGdsb2JhbDogZ2xvYmFsXG4gICAgfSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LWZ1bmN0aW9uXG4gIGFzeW5jIHNldHVwKCkge31cbiAgYXN5bmMgdGVhcmRvd24oKSB7XG4gICAgaWYgKHRoaXMuZmFrZVRpbWVycykge1xuICAgICAgdGhpcy5mYWtlVGltZXJzLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZmFrZVRpbWVyc01vZGVybikge1xuICAgICAgdGhpcy5mYWtlVGltZXJzTW9kZXJuLmRpc3Bvc2UoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZ2xvYmFsICE9IG51bGwpIHtcbiAgICAgIGlmICh0aGlzLmVycm9yRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmdsb2JhbC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMuZXJyb3JFdmVudExpc3RlbmVyKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2xvYmFsLmNsb3NlKCk7XG4gICAgfVxuICAgIHRoaXMuZXJyb3JFdmVudExpc3RlbmVyID0gbnVsbDtcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yOiB0aGlzLmdsb2JhbCBub3QgYWxsb3dlZCB0byBiZSBgbnVsbGBcbiAgICB0aGlzLmdsb2JhbCA9IG51bGw7XG4gICAgdGhpcy5kb20gPSBudWxsO1xuICAgIHRoaXMuZmFrZVRpbWVycyA9IG51bGw7XG4gICAgdGhpcy5mYWtlVGltZXJzTW9kZXJuID0gbnVsbDtcbiAgfVxuICBleHBvcnRDb25kaXRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLmN1c3RvbUV4cG9ydENvbmRpdGlvbnM7XG4gIH1cbiAgZ2V0Vm1Db250ZXh0KCkge1xuICAgIGlmICh0aGlzLmRvbSkge1xuICAgICAgcmV0dXJuIHRoaXMuZG9tLmdldEludGVybmFsVk1Db250ZXh0KCk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBKU0RPTUVudmlyb25tZW50O1xuY29uc3QgVGVzdEVudmlyb25tZW50ID0gSlNET01FbnZpcm9ubWVudDtcbmV4cG9ydHMuVGVzdEVudmlyb25tZW50ID0gVGVzdEVudmlyb25tZW50O1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaQSxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUMzQ0MsS0FBSyxFQUFFO0FBQ1QsQ0FBQyxDQUFDO0FBQ0ZELE9BQU8sQ0FBQ0UsT0FBTyxHQUFHRixPQUFPLENBQUNHLGVBQWUsR0FBRyxLQUFLLENBQUM7QUFDbEQsU0FBU0MsTUFBTUEsQ0FBQSxFQUFHO0VBQ2hCLE1BQU1DLElBQUksR0FBR0MsT0FBTyxDQUFDLE9BQU8sQ0FBQztFQUM3QkYsTUFBTSxHQUFHLFNBQUFBLENBQUEsRUFBWTtJQUNuQixPQUFPQyxJQUFJO0VBQ2IsQ0FBQztFQUNELE9BQU9BLElBQUk7QUFDYjtBQUNBLFNBQVNFLFdBQVdBLENBQUEsRUFBRztFQUNyQixNQUFNRixJQUFJLEdBQUdDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztFQUN6Q0MsV0FBVyxHQUFHLFNBQUFBLENBQUEsRUFBWTtJQUN4QixPQUFPRixJQUFJO0VBQ2IsQ0FBQztFQUNELE9BQU9BLElBQUk7QUFDYjtBQUNBLFNBQVNHLFNBQVNBLENBQUEsRUFB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