26d64500744f769acd87ae342b449508
/* istanbul ignore next */
"use strict";

var wrappy = require('wrappy');
var reqs = Object.create(null);
var once = require('once');
module.exports = wrappy(inflight);
function inflight(key, cb) {
  if (reqs[key]) {
    reqs[key].push(cb);
    return null;
  } else {
    reqs[key] = [cb];
    return makeres(key);
  }
}
function makeres(key) {
  return once(function RES() {
    var cbs = reqs[key];
    var len = cbs.length;
    var args = slice(arguments);

    // XXX It's somewhat ambiguous whether a new callback added in this
    // pass should be queued for later execution if something in the
    // list of callbacks throws, or if it should just be discarded.
    // However, it's such an edge case that it hardly matters, and either
    // choice is likely as surprising as the other.
    // As it happens, we do go ahead and schedule it for later execution.
    try {
      for (var i = 0; i < len; i++) {
        cbs[i].apply(null, args);
      }
    } finally {
      if (cbs.length > len) {
        // added more in the interim.
        // de-zalgo, just in case, but don't call again.
        cbs.splice(0, len);
        process.nextTick(function () {
          RES.apply(null, args);
        });
      } else {
        delete reqs[key];
      }
    }
  });
}
function slice(args) {
  var length = args.length;
  var array = [];
  for (var i = 0; i < length; i++) array[i] = args[i];
  return array;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ3cmFwcHkiLCJyZXF1aXJlIiwicmVxcyIsIk9iamVjdCIsImNyZWF0ZSIsIm9uY2UiLCJtb2R1bGUiLCJleHBvcnRzIiwiaW5mbGlnaHQiLCJrZXkiLCJjYiIsInB1c2giLCJtYWtlcmVzIiwiUkVTIiwiY2JzIiwibGVuIiwibGVuZ3RoIiwiYXJncyIsInNsaWNlIiwiYXJndW1lbnRzIiwiaSIsImFwcGx5Iiwic3BsaWNlIiwicHJvY2VzcyIsIm5leHRUaWNrIiwiYXJyYXkiXSwic291cmNlcyI6WyJpbmZsaWdodC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgd3JhcHB5ID0gcmVxdWlyZSgnd3JhcHB5JylcbnZhciByZXFzID0gT2JqZWN0LmNyZWF0ZShudWxsKVxudmFyIG9uY2UgPSByZXF1aXJlKCdvbmNlJylcblxubW9kdWxlLmV4cG9ydHMgPSB3cmFwcHkoaW5mbGlnaHQpXG5cbmZ1bmN0aW9uIGluZmxpZ2h0IChrZXksIGNiKSB7XG4gIGlmIChyZXFzW2tleV0pIHtcbiAgICByZXFzW2tleV0ucHVzaChjYilcbiAgICByZXR1cm4gbnVsbFxuICB9IGVsc2Uge1xuICAgIHJlcXNba2V5XSA9IFtjYl1cbiAgICByZXR1cm4gbWFrZXJlcyhrZXkpXG4gIH1cbn1cblxuZnVuY3Rpb24gbWFrZXJlcyAoa2V5KSB7XG4gIHJldHVybiBvbmNlKGZ1bmN0aW9uIFJFUyAoKSB7XG4gICAgdmFyIGNicyA9IHJlcXNba2V5XVxuICAgIHZhciBsZW4gPSBjYnMubGVuZ3RoXG4gICAgdmFyIGFyZ3MgPSBzbGljZShhcmd1bWVudHMpXG5cbiAgICAvLyBYWFggSXQncyBzb21ld2hhdCBhbWJpZ3VvdXMgd2hldGhlciBhIG5ldyBjYWxsYmFjayBhZGRlZCBpbiB0aGlzXG4gICAgLy8gcGFzcyBzaG91bGQgYmUgcXVldWVkIGZvciBsYXRlciBleGVjdXRpb24gaWYgc29tZXRoaW5nIGluIHRoZVxuICAgIC8vIGxpc3Qgb2YgY2FsbGJhY2tzIHRocm93cywgb3IgaWYgaXQgc2hvdWxkIGp1c3QgYmUgZGlzY2FyZGVkLlxuICAgIC8vIEhvd2V2ZXIsIGl0J3Mgc3VjaCBhbiBlZGdlIGNhc2UgdGhhdCBpdCBoYXJkbHkgbWF0dGVycywgYW5kIGVpdGhlclxuICAgIC8vIGNob2ljZSBpcyBsaWtlbHkgYXMgc3VycHJpc2luZyBhcyB0aGUgb3RoZXIuXG4gICAgLy8gQXMgaXQgaGFwcGVucywgd2UgZG8gZ28gYWhlYWQgYW5kIHNjaGVkdWxlIGl0IGZvciBsYXRlciBleGVjdXRpb24uXG4gICAgdHJ5IHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgY2JzW2ldLmFwcGx5KG51bGwsIGFyZ3MpXG4gICAgICB9XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChjYnMubGVuZ3RoID4gbGVuKSB7XG4gICAgICAgIC8vIGFkZGVkIG1vcmUgaW4gdGhlIGludGVyaW0uXG4gICAgICAgIC8vIGRlLXphbGdvLCBqdXN0IGluIGNhc2UsIGJ1dCBkb24ndCBjYWxsIGFnYWluLlxuICAgICAgICBjYnMuc3BsaWNlKDAsIGxlbilcbiAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgUkVTLmFwcGx5KG51bGwsIGFyZ3MpXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWxldGUgcmVxc1trZXldXG4gICAgICB9XG4gICAgfVxuICB9KVxufVxuXG5mdW5jdGlvbiBzbGljZSAoYXJncykge1xuICB2YXIgbGVuZ3RoID0gYXJncy5sZW5ndGhcbiAgdmFyIGFycmF5ID0gW11cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSBhcnJheVtpXSA9IGFyZ3NbaV1cbiAgcmV0dXJuIGFycmF5XG59XG4iXSwibWFwcGluZ3MiOiI7OztBQUFBLElBQUlBLE1BQU0sR0FBR0MsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUM5QixJQUFJQyxJQUFJLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDLElBQUksQ0FBQztBQUM5QixJQUFJQyxJQUFJLEdBQUdKLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFFMUJLLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHUCxNQUFNLENBQUNRLFFBQVEsQ0FBQztBQUVqQyxTQUFTQSxRQUFRQSxDQUFFQyxHQUFHLEVBQUVDLEVBQUUsRUFBRTtFQUMxQixJQUFJUixJQUFJLENBQUNPLEdBQUcsQ0FBQyxFQUFFO0lBQ2JQLElBQUksQ0FBQ08sR0FBRyxDQUFDLENBQUNFLElBQUksQ0FBQ0QsRUFBRSxDQUFDO0lBQ2xCLE9BQU8sSUFBSTtFQUNiLENBQUMsTUFBTTtJQUNMUixJQUFJLENBQUNPLEdBQUcsQ0FBQyxHQUFHLENBQUNDLEVBQUUsQ0FBQztJQUNoQixPQUFPRSxPQUFPLENBQUNILEdBQUcsQ0FBQztFQUNyQjtBQUNGO0FBRUEsU0FBU0csT0FBT0EsQ0FBRUgsR0FBRyxFQUFFO0VBQ3JCLE9BQU9KLElBQUksQ0FBQyxTQUFTUSxHQUFHQSxDQUFBLEVBQUk7SUFDMUIsSUFBSUMsR0FBRyxHQUFHWixJQUFJLENBQUNPLEdBQUcsQ0FBQztJQUNuQixJQUFJTSxHQUFHLEdBQUdELEdBQUcsQ0FBQ0UsTUFBTTtJQUNwQixJQUFJQyxJQUFJLEdBQUdDLEtBQUssQ0FBQ0MsU0FBUyxDQUFDOztJQUUzQjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQSxJQUFJO01BQ0YsS0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdMLEdBQUcsRUFBRUssQ0FBQyxFQUFFLEVBQUU7UUFDNUJOLEdBQUcsQ0FBQ00sQ0FBQyxDQUFDLENBQUNDLEtBQUssQ0FBQyxJQUFJLEVBQUVKLElBQUksQ0FBQztNQUMxQjtJQUNGLENBQUMsU0FBUztNQUNSLElBQUlILEdBQUcsQ0FBQ0UsTUFBTSxHQUFHRCxHQUFHLEVBQUU7UUFDcEI7UUFDQTtRQUNBRCxHQUFHLENBQUNRLE1BQU0sQ0FBQyxDQUFDLEVBQUVQLEdBQUcsQ0FBQztRQUNsQlEsT0FBTyxDQUFDQyxRQUFRLENBQUMsWUFBWTtVQUMzQlgsR0FBRyxDQUFDUSxLQUFLLENBQUMsSUFBSSxFQUFFSixJQUFJLENBQUM7UUFDdkIsQ0FBQyxDQUFDO01BQ0osQ0FBQyxNQUFNO1FBQ0wsT0FBT2YsSUFBSSxDQUFDTyxHQUFHLENBQUM7TUFDbEI7SUFDRjtFQUNGLENBQUMsQ0FBQztBQUNKO0FBRUEsU0FBU1MsS0FBS0EsQ0FBRUQsSUFBSSxFQUFFO0VBQ3BCLElBQUlELE1BQU0sR0FBR0MsSUFBSSxDQUFDRCxNQUFNO0VBQ3hCLElBQUlTLEtBQUssR0FBRyxFQUFFO0VBRWQsS0FBSyxJQUFJTCxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdKLE1BQU0sRUFBRUksQ0FBQyxFQUFFLEVBQUVLLEtBQUssQ0FBQ0wsQ0FBQyxDQUFDLEdBQUdILElBQUksQ0FBQ0csQ0FBQyxDQUFDO0VBQ25ELE9BQU9LLEtBQUs7QUFDZCJ9