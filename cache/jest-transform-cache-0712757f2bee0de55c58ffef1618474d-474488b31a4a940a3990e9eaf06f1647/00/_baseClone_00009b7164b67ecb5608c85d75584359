78aad9c62ba109b0d611fad197092a1e
/* istanbul ignore next */
"use strict";

var Stack = require('./_Stack'),
  arrayEach = require('./_arrayEach'),
  assignValue = require('./_assignValue'),
  baseAssign = require('./_baseAssign'),
  baseAssignIn = require('./_baseAssignIn'),
  cloneBuffer = require('./_cloneBuffer'),
  copyArray = require('./_copyArray'),
  copySymbols = require('./_copySymbols'),
  copySymbolsIn = require('./_copySymbolsIn'),
  getAllKeys = require('./_getAllKeys'),
  getAllKeysIn = require('./_getAllKeysIn'),
  getTag = require('./_getTag'),
  initCloneArray = require('./_initCloneArray'),
  initCloneByTag = require('./_initCloneByTag'),
  initCloneObject = require('./_initCloneObject'),
  isArray = require('./isArray'),
  isBuffer = require('./isBuffer'),
  isMap = require('./isMap'),
  isObject = require('./isObject'),
  isSet = require('./isSet'),
  keys = require('./keys'),
  keysIn = require('./keysIn');

/** Used to compose bitmasks for cloning. */
var CLONE_DEEP_FLAG = 1,
  CLONE_FLAT_FLAG = 2,
  CLONE_SYMBOLS_FLAG = 4;

/** `Object#toString` result references. */
var argsTag = '[object Arguments]',
  arrayTag = '[object Array]',
  boolTag = '[object Boolean]',
  dateTag = '[object Date]',
  errorTag = '[object Error]',
  funcTag = '[object Function]',
  genTag = '[object GeneratorFunction]',
  mapTag = '[object Map]',
  numberTag = '[object Number]',
  objectTag = '[object Object]',
  regexpTag = '[object RegExp]',
  setTag = '[object Set]',
  stringTag = '[object String]',
  symbolTag = '[object Symbol]',
  weakMapTag = '[object WeakMap]';
var arrayBufferTag = '[object ArrayBuffer]',
  dataViewTag = '[object DataView]',
  float32Tag = '[object Float32Array]',
  float64Tag = '[object Float64Array]',
  int8Tag = '[object Int8Array]',
  int16Tag = '[object Int16Array]',
  int32Tag = '[object Int32Array]',
  uint8Tag = '[object Uint8Array]',
  uint8ClampedTag = '[object Uint8ClampedArray]',
  uint16Tag = '[object Uint16Array]',
  uint32Tag = '[object Uint32Array]';

/** Used to identify `toStringTag` values supported by `_.clone`. */
var cloneableTags = {};
cloneableTags[argsTag] = cloneableTags[arrayTag] = cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] = cloneableTags[boolTag] = cloneableTags[dateTag] = cloneableTags[float32Tag] = cloneableTags[float64Tag] = cloneableTags[int8Tag] = cloneableTags[int16Tag] = cloneableTags[int32Tag] = cloneableTags[mapTag] = cloneableTags[numberTag] = cloneableTags[objectTag] = cloneableTags[regexpTag] = cloneableTags[setTag] = cloneableTags[stringTag] = cloneableTags[symbolTag] = cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] = cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
cloneableTags[errorTag] = cloneableTags[funcTag] = cloneableTags[weakMapTag] = false;

/**
 * The base implementation of `_.clone` and `_.cloneDeep` which tracks
 * traversed objects.
 *
 * @private
 * @param {*} value The value to clone.
 * @param {boolean} bitmask The bitmask flags.
 *  1 - Deep clone
 *  2 - Flatten inherited properties
 *  4 - Clone symbols
 * @param {Function} [customizer] The function to customize cloning.
 * @param {string} [key] The key of `value`.
 * @param {Object} [object] The parent object of `value`.
 * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
 * @returns {*} Returns the cloned value.
 */
function baseClone(value, bitmask, customizer, key, object, stack) {
  var result,
    isDeep = bitmask & CLONE_DEEP_FLAG,
    isFlat = bitmask & CLONE_FLAT_FLAG,
    isFull = bitmask & CLONE_SYMBOLS_FLAG;
  if (customizer) {
    result = object ? customizer(value, key, object, stack) : customizer(value);
  }
  if (result !== undefined) {
    return result;
  }
  if (!isObject(value)) {
    return value;
  }
  var isArr = isArray(value);
  if (isArr) {
    result = initCloneArray(value);
    if (!isDeep) {
      return copyArray(value, result);
    }
  } else {
    var tag = getTag(value),
      isFunc = tag == funcTag || tag == genTag;
    if (isBuffer(value)) {
      return cloneBuffer(value, isDeep);
    }
    if (tag == objectTag || tag == argsTag || isFunc && !object) {
      result = isFlat || isFunc ? {} : initCloneObject(value);
      if (!isDeep) {
        return isFlat ? copySymbolsIn(value, baseAssignIn(result, value)) : copySymbols(value, baseAssign(result, value));
      }
    } else {
      if (!cloneableTags[tag]) {
        return object ? value : {};
      }
      result = initCloneByTag(value, tag, isDeep);
    }
  }
  // Check for circular references and return its corresponding clone.
  stack || (stack = new Stack());
  var stacked = stack.get(value);
  if (stacked) {
    return stacked;
  }
  stack.set(value, result);
  if (isSet(value)) {
    value.forEach(function (subValue) {
      result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));
    });
  } else if (isMap(value)) {
    value.forEach(function (subValue, key) {
      result.set(key, baseClone(subValue, bitmask, customizer, key, value, stack));
    });
  }
  var keysFunc = isFull ? isFlat ? getAllKeysIn : getAllKeys : isFlat ? keysIn : keys;
  var props = isArr ? undefined : keysFunc(value);
  arrayEach(props || value, function (subValue, key) {
    if (props) {
      key = subValue;
      subValue = value[key];
    }
    // Recursively populate clone (susceptible to call stack limits).
    assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));
  });
  return result;
}
module.exports = baseClone;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdGFjayIsInJlcXVpcmUiLCJhcnJheUVhY2giLCJhc3NpZ25WYWx1ZSIsImJhc2VBc3NpZ24iLCJiYXNlQXNzaWduSW4iLCJjbG9uZUJ1ZmZlciIsImNvcHlBcnJheSIsImNvcHlTeW1ib2xzIiwiY29weVN5bWJvbHNJbiIsImdldEFsbEtleXMiLCJnZXRBbGxLZXlzSW4iLCJnZXRUYWciLCJpbml0Q2xvbmVBcnJheSIsImluaXRDbG9uZUJ5VGFnIiwiaW5pdENsb25lT2JqZWN0IiwiaXNBcnJheSIsImlzQnVmZmVyIiwiaXNNYXAiLCJpc09iamVjdCIsImlzU2V0Iiwia2V5cyIsImtleXNJbiIsIkNMT05FX0RFRVBfRkxBRyIsIkNMT05FX0ZMQVRfRkxBRyIsIkNMT05FX1NZTUJPTFNfRkxBRyIsImFyZ3NUYWciLCJhcnJheVRhZyIsImJvb2xUYWciLCJkYXRlVGFnIiwiZXJyb3JUYWciLCJmdW5jVGFnIiwiZ2VuVGFnIiwibWFwVGFnIiwibnVtYmVyVGFnIiwib2JqZWN0VGFnIiwicmVnZXhwVGFnIiwic2V0VGFnIiwic3RyaW5nVGFnIiwic3ltYm9sVGFnIiwid2Vha01hcFRhZyIsImFycmF5QnVmZmVyVGFnIiwiZGF0YVZpZXdUYWciLCJmbG9hdDMyVGFnIiwiZmxvYXQ2NFRhZyIsImludDhUYWciLCJpbnQxNlRhZyIsImludDMyVGFnIiwidWludDhUYWciLCJ1aW50OENsYW1wZWRUYWciLCJ1aW50MTZUYWciLCJ1aW50MzJUYWciLCJjbG9uZWFibGVUYWdzIiwiYmFzZUNsb25lIiwidmFsdWUiLCJiaXRtYXNrIiwiY3VzdG9taXplciIsImtleSIsIm9iamVjdCIsInN0YWNrIiwicmVzdWx0IiwiaXNEZWVwIiwiaXNGbGF0IiwiaXNGdWxsIiwidW5kZWZpbmVkIiwiaXNBcnIiLCJ0YWciLCJpc0Z1bmMiLCJzdGFja2VkIiwiZ2V0Iiwic2V0IiwiZm9yRWFjaCIsInN1YlZhbHVlIiwiYWRkIiwia2V5c0Z1bmMiLCJwcm9wcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJfYmFzZUNsb25lLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBTdGFjayA9IHJlcXVpcmUoJy4vX1N0YWNrJyksXG4gICAgYXJyYXlFYWNoID0gcmVxdWlyZSgnLi9fYXJyYXlFYWNoJyksXG4gICAgYXNzaWduVmFsdWUgPSByZXF1aXJlKCcuL19hc3NpZ25WYWx1ZScpLFxuICAgIGJhc2VBc3NpZ24gPSByZXF1aXJlKCcuL19iYXNlQXNzaWduJyksXG4gICAgYmFzZUFzc2lnbkluID0gcmVxdWlyZSgnLi9fYmFzZUFzc2lnbkluJyksXG4gICAgY2xvbmVCdWZmZXIgPSByZXF1aXJlKCcuL19jbG9uZUJ1ZmZlcicpLFxuICAgIGNvcHlBcnJheSA9IHJlcXVpcmUoJy4vX2NvcHlBcnJheScpLFxuICAgIGNvcHlTeW1ib2xzID0gcmVxdWlyZSgnLi9fY29weVN5bWJvbHMnKSxcbiAgICBjb3B5U3ltYm9sc0luID0gcmVxdWlyZSgnLi9fY29weVN5bWJvbHNJbicpLFxuICAgIGdldEFsbEtleXMgPSByZXF1aXJlKCcuL19nZXRBbGxLZXlzJyksXG4gICAgZ2V0QWxsS2V5c0luID0gcmVxdWlyZSgnLi9fZ2V0QWxsS2V5c0luJyksXG4gICAgZ2V0VGFnID0gcmVxdWlyZSgnLi9fZ2V0VGFnJyksXG4gICAgaW5pdENsb25lQXJyYXkgPSByZXF1aXJlKCcuL19pbml0Q2xvbmVBcnJheScpLFxuICAgIGluaXRDbG9uZUJ5VGFnID0gcmVxdWlyZSgnLi9faW5pdENsb25lQnlUYWcnKSxcbiAgICBpbml0Q2xvbmVPYmplY3QgPSByZXF1aXJlKCcuL19pbml0Q2xvbmVPYmplY3QnKSxcbiAgICBpc0FycmF5ID0gcmVxdWlyZSgnLi9pc0FycmF5JyksXG4gICAgaXNCdWZmZXIgPSByZXF1aXJlKCcuL2lzQnVmZmVyJyksXG4gICAgaXNNYXAgPSByZXF1aXJlKCcuL2lzTWFwJyksXG4gICAgaXNPYmplY3QgPSByZXF1aXJlKCcuL2lzT2JqZWN0JyksXG4gICAgaXNTZXQgPSByZXF1aXJlKCcuL2lzU2V0JyksXG4gICAga2V5cyA9IHJlcXVpcmUoJy4va2V5cycpLFxuICAgIGtleXNJbiA9IHJlcXVpcmUoJy4va2V5c0luJyk7XG5cbi8qKiBVc2VkIHRvIGNvbXBvc2UgYml0bWFza3MgZm9yIGNsb25pbmcuICovXG52YXIgQ0xPTkVfREVFUF9GTEFHID0gMSxcbiAgICBDTE9ORV9GTEFUX0ZMQUcgPSAyLFxuICAgIENMT05FX1NZTUJPTFNfRkxBRyA9IDQ7XG5cbi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi9cbnZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsXG4gICAgYXJyYXlUYWcgPSAnW29iamVjdCBBcnJheV0nLFxuICAgIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsXG4gICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsXG4gICAgZnVuY1RhZyA9ICdbb2JqZWN0IEZ1bmN0aW9uXScsXG4gICAgZ2VuVGFnID0gJ1tvYmplY3QgR2VuZXJhdG9yRnVuY3Rpb25dJyxcbiAgICBtYXBUYWcgPSAnW29iamVjdCBNYXBdJyxcbiAgICBudW1iZXJUYWcgPSAnW29iamVjdCBOdW1iZXJdJyxcbiAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJyxcbiAgICByZWdleHBUYWcgPSAnW29iamVjdCBSZWdFeHBdJyxcbiAgICBzZXRUYWcgPSAnW29iamVjdCBTZXRdJyxcbiAgICBzdHJpbmdUYWcgPSAnW29iamVjdCBTdHJpbmddJyxcbiAgICBzeW1ib2xUYWcgPSAnW29iamVjdCBTeW1ib2xdJyxcbiAgICB3ZWFrTWFwVGFnID0gJ1tvYmplY3QgV2Vha01hcF0nO1xuXG52YXIgYXJyYXlCdWZmZXJUYWcgPSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nLFxuICAgIGRhdGFWaWV3VGFnID0gJ1tvYmplY3QgRGF0YVZpZXddJyxcbiAgICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsXG4gICAgZmxvYXQ2NFRhZyA9ICdbb2JqZWN0IEZsb2F0NjRBcnJheV0nLFxuICAgIGludDhUYWcgPSAnW29iamVjdCBJbnQ4QXJyYXldJyxcbiAgICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJyxcbiAgICBpbnQzMlRhZyA9ICdbb2JqZWN0IEludDMyQXJyYXldJyxcbiAgICB1aW50OFRhZyA9ICdbb2JqZWN0IFVpbnQ4QXJyYXldJyxcbiAgICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLFxuICAgIHVpbnQxNlRhZyA9ICdbb2JqZWN0IFVpbnQxNkFycmF5XScsXG4gICAgdWludDMyVGFnID0gJ1tvYmplY3QgVWludDMyQXJyYXldJztcblxuLyoqIFVzZWQgdG8gaWRlbnRpZnkgYHRvU3RyaW5nVGFnYCB2YWx1ZXMgc3VwcG9ydGVkIGJ5IGBfLmNsb25lYC4gKi9cbnZhciBjbG9uZWFibGVUYWdzID0ge307XG5jbG9uZWFibGVUYWdzW2FyZ3NUYWddID0gY2xvbmVhYmxlVGFnc1thcnJheVRhZ10gPVxuY2xvbmVhYmxlVGFnc1thcnJheUJ1ZmZlclRhZ10gPSBjbG9uZWFibGVUYWdzW2RhdGFWaWV3VGFnXSA9XG5jbG9uZWFibGVUYWdzW2Jvb2xUYWddID0gY2xvbmVhYmxlVGFnc1tkYXRlVGFnXSA9XG5jbG9uZWFibGVUYWdzW2Zsb2F0MzJUYWddID0gY2xvbmVhYmxlVGFnc1tmbG9hdDY0VGFnXSA9XG5jbG9uZWFibGVUYWdzW2ludDhUYWddID0gY2xvbmVhYmxlVGFnc1tpbnQxNlRhZ10gPVxuY2xvbmVhYmxlVGFnc1tpbnQzMlRhZ10gPSBjbG9uZWFibGVUYWdzW21hcFRhZ10gPVxuY2xvbmVhYmxlVGFnc1tudW1iZXJUYWddID0gY2xvbmVhYmxlVGFnc1tvYmplY3RUYWddID1cbmNsb25lYWJsZVRhZ3NbcmVnZXhwVGFnXSA9IGNsb25lYWJsZVRhZ3Nbc2V0VGFnXSA9XG5jbG9uZWFibGVUYWdzW3N0cmluZ1RhZ10gPSBjbG9uZWFibGVUYWdzW3N5bWJvbFRhZ10gPVxuY2xvbmVhYmxlVGFnc1t1aW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPVxuY2xvbmVhYmxlVGFnc1t1aW50MTZUYWddID0gY2xvbmVhYmxlVGFnc1t1aW50MzJUYWddID0gdHJ1ZTtcbmNsb25lYWJsZVRhZ3NbZXJyb3JUYWddID0gY2xvbmVhYmxlVGFnc1tmdW5jVGFnXSA9XG5jbG9uZWFibGVUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7XG5cbi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY2xvbmVgIGFuZCBgXy5jbG9uZURlZXBgIHdoaWNoIHRyYWNrc1xuICogdHJhdmVyc2VkIG9iamVjdHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNsb25lLlxuICogQHBhcmFtIHtib29sZWFufSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLlxuICogIDEgLSBEZWVwIGNsb25lXG4gKiAgMiAtIEZsYXR0ZW4gaW5oZXJpdGVkIHByb3BlcnRpZXNcbiAqICA0IC0gQ2xvbmUgc3ltYm9sc1xuICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY2xvbmluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBba2V5XSBUaGUga2V5IG9mIGB2YWx1ZWAuXG4gKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIHBhcmVudCBvYmplY3Qgb2YgYHZhbHVlYC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgb2JqZWN0cyBhbmQgdGhlaXIgY2xvbmUgY291bnRlcnBhcnRzLlxuICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGNsb25lZCB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gYmFzZUNsb25lKHZhbHVlLCBiaXRtYXNrLCBjdXN0b21pemVyLCBrZXksIG9iamVjdCwgc3RhY2spIHtcbiAgdmFyIHJlc3VsdCxcbiAgICAgIGlzRGVlcCA9IGJpdG1hc2sgJiBDTE9ORV9ERUVQX0ZMQUcsXG4gICAgICBpc0ZsYXQgPSBiaXRtYXNrICYgQ0xPTkVfRkxBVF9GTEFHLFxuICAgICAgaXNGdWxsID0gYml0bWFzayAmIENMT05FX1NZTUJPTFNfRkxBRztcblxuICBpZiAoY3VzdG9taXplcikge1xuICAgIHJlc3VsdCA9IG9iamVjdCA/IGN1c3RvbWl6ZXIodmFsdWUsIGtleSwgb2JqZWN0LCBzdGFjaykgOiBjdXN0b21pemVyKHZhbHVlKTtcbiAgfVxuICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIGlmICghaXNPYmplY3QodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIHZhciBpc0FyciA9IGlzQXJyYXkodmFsdWUpO1xuICBpZiAoaXNBcnIpIHtcbiAgICByZXN1bHQgPSBpbml0Q2xvbmVBcnJheSh2YWx1ZSk7XG4gICAgaWYgKCFpc0RlZXApIHtcbiAgICAgIHJldHVybiBjb3B5QXJyYXkodmFsdWUsIHJlc3VsdCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHZhciB0YWcgPSBnZXRUYWcodmFsdWUpLFxuICAgICAgICBpc0Z1bmMgPSB0YWcgPT0gZnVuY1RhZyB8fCB0YWcgPT0gZ2VuVGFnO1xuXG4gICAgaWYgKGlzQnVmZmVyKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIGNsb25lQnVmZmVyKHZhbHVlLCBpc0RlZXApO1xuICAgIH1cbiAgICBpZiAodGFnID09IG9iamVjdFRhZyB8fCB0YWcgPT0gYXJnc1RhZyB8fCAoaXNGdW5jICYmICFvYmplY3QpKSB7XG4gICAgICByZXN1bHQgPSAoaXNGbGF0IHx8IGlzRnVuYykgPyB7fSA6IGluaXRDbG9uZU9iamVjdCh2YWx1ZSk7XG4gICAgICBpZiAoIWlzRGVlcCkge1xuICAgICAgICByZXR1cm4gaXNGbGF0XG4gICAgICAgICAgPyBjb3B5U3ltYm9sc0luKHZhbHVlLCBiYXNlQXNzaWduSW4ocmVzdWx0LCB2YWx1ZSkpXG4gICAgICAgICAgOiBjb3B5U3ltYm9scyh2YWx1ZSwgYmFzZUFzc2lnbihyZXN1bHQsIHZhbHVlKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghY2xvbmVhYmxlVGFnc1t0YWddKSB7XG4gICAgICAgIHJldHVybiBvYmplY3QgPyB2YWx1ZSA6IHt9O1xuICAgICAgfVxuICAgICAgcmVzdWx0ID0gaW5pdENsb25lQnlUYWcodmFsdWUsIHRhZywgaXNEZWVwKTtcbiAgICB9XG4gIH1cbiAgLy8gQ2hlY2sgZm9yIGNpcmN1bGFyIHJlZmVyZW5jZXMgYW5kIHJldHVybiBpdHMgY29ycmVzcG9uZGluZyBjbG9uZS5cbiAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTtcbiAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQodmFsdWUpO1xuICBpZiAoc3RhY2tlZCkge1xuICAgIHJldHVybiBzdGFja2VkO1xuICB9XG4gIHN0YWNrLnNldCh2YWx1ZSwgcmVzdWx0KTtcblxuICBpZiAoaXNTZXQodmFsdWUpKSB7XG4gICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbihzdWJWYWx1ZSkge1xuICAgICAgcmVzdWx0LmFkZChiYXNlQ2xvbmUoc3ViVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN1YlZhbHVlLCB2YWx1ZSwgc3RhY2spKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChpc01hcCh2YWx1ZSkpIHtcbiAgICB2YWx1ZS5mb3JFYWNoKGZ1bmN0aW9uKHN1YlZhbHVlLCBrZXkpIHtcbiAgICAgIHJlc3VsdC5zZXQoa2V5LCBiYXNlQ2xvbmUoc3ViVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGtleSwgdmFsdWUsIHN0YWNrKSk7XG4gICAgfSk7XG4gIH1cblxuICB2YXIga2V5c0Z1bmMgPSBpc0Z1bGxcbiAgICA/IChpc0ZsYXQgPyBnZXRBbGxLZXlzSW4gOiBnZXRBbGxLZXlzKVxuICAgIDogKGlzRmxhdCA/IGtleXNJbiA6IGtleXMpO1xuXG4gIHZhciBwcm9wcyA9IGlzQXJyID8gdW5kZWZpbmVkIDoga2V5c0Z1bmModmFsdWUpO1xuICBhcnJheUVhY2gocHJvcHMgfHwgdmFsdWUsIGZ1bmN0aW9uKHN1YlZhbHVlLCBrZXkpIHtcbiAgICBpZiAocHJvcHMpIHtcbiAgICAgIGtleSA9IHN1YlZhbHVlO1xuICAgICAgc3ViVmFsdWUgPSB2YWx1ZVtrZXldO1xuICAgIH1cbiAgICAvLyBSZWN1cnNpdmVseSBwb3B1bGF0ZSBjbG9uZSAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgIGFzc2lnblZhbHVlKHJlc3VsdCwga2V5LCBiYXNlQ2xvbmUoc3ViVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGtleSwgdmFsdWUsIHN0YWNrKSk7XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGJhc2VDbG9uZTtcbiJdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0VBQzNCQyxTQUFTLEdBQUdELE9BQU8sQ0FBQyxjQUFjLENBQUM7RUFDbkNFLFdBQVcsR0FBR0YsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0VBQ3ZDRyxVQUFVLEdBQUdILE9BQU8sQ0FBQyxlQUFlLENBQUM7RUFDckNJLFlBQVksR0FBR0osT0FBTyxDQUFDLGlCQUFpQixDQUFDO0VBQ3pDSyxXQUFXLEdBQUdMLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztFQUN2Q00sU0FBUyxHQUFHTixPQUFPLENBQUMsY0FBYyxDQUFDO0VBQ25DTyxXQUFXLEdBQUdQLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztFQUN2Q1EsYUFBYSxHQUFHUixPQUFPLENBQUMsa0JBQWtCLENBQUM7RUFDM0NTLFVBQVUsR0FBR1QsT0FBTyxDQUFDLGVBQWUsQ0FBQztFQUNyQ1UsWUFBWSxHQUFHVixPQUFPLENBQUMsaUJBQWlCLENBQUM7RUFDekNXLE1BQU0sR0FBR1gsT0FB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